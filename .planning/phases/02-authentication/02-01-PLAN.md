---
phase: '02-authentication'
plan: '01'
type: 'execute'
wave: 1
depends_on: []
files_modified:
  - 'src/app/sign-in/[[...sign-in]]/page.tsx'
  - 'src/app/sign-up/[[...sign-up]]/page.tsx'
  - 'src/app/forgot-password/page.tsx'
  - 'src/components/auth/user-button.tsx'
autonomous: true
user_setup: []
must_haves:
  truths:
    - 'User can navigate to /sign-in and see custom sign-in page'
    - 'User can navigate to /sign-up and see custom sign-up page'
    - 'User can navigate to /forgot-password and see password reset page'
    - 'User can see Sign In button when signed out in header'
    - 'User can see User avatar when signed in in header'
  artifacts:
    - path: 'src/app/sign-in/[[...sign-in]]/page.tsx'
      provides: 'Custom sign-in page with Clerk SignIn component'
      min_lines: 20
    - path: 'src/app/sign-up/[[...sign-up]]/page.tsx'
      provides: 'Custom sign-up page with Clerk SignUp component'
      min_lines: 20
    - path: 'src/app/forgot-password/page.tsx'
      provides: 'Custom password reset page with two-step flow'
      min_lines: 50
    - path: 'src/components/auth/user-button.tsx'
      provides: 'User button component with SignedIn/SignedOut states'
      min_lines: 20
  key_links:
    - from: 'src/app/sign-in/[[...sign-in]]/page.tsx'
      to: '@clerk/nextjs'
      via: 'SignIn component'
      pattern: 'SignIn.*appearance'
    - from: 'src/app/sign-up/[[...sign-up]]/page.tsx'
      to: '@clerk/nextjs'
      via: 'SignUp component'
      pattern: 'SignUp.*appearance'
    - from: 'src/app/forgot-password/page.tsx'
      to: '@clerk/nextjs'
      via: 'useSignIn hook'
      pattern: 'useSignIn.*reset_password_email_code'
    - from: 'src/components/auth/user-button.tsx'
      to: '@clerk/nextjs'
      via: 'SignedIn, SignedOut, UserButton'
      pattern: 'SignedIn|SignedOut|UserButton'
---

<objective>
Create custom authentication pages and user button component for the application.

Purpose: Provide branded, custom auth experience with sign-in, sign-up, password reset, and persistent user state in header.
Output: Working custom auth pages and user button component
</objective>

<execution_context>
@C:/Users/ASUS/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/ASUS/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@src/app/layout.tsx
@middleware.ts

# Research findings from 02-RESEARCH.md

- Clerk is already integrated with ClerkProvider in layout.tsx
- clerkMiddleware is configured in middleware.ts
- Custom pages need to use Clerk's pre-built <SignIn> and <SignUp /> components
- Password reset uses reset_password_email_code strategy with two-step flow
- UserButton component uses SignedIn/SignedOut for conditional rendering
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Create custom sign-in page</name>
  <files>src/app/sign-in/[[...sign-in]]/page.tsx</files>
  <action>
    Create directory structure src/app/sign-in/[[...sign-in]]/
    Create page.tsx with Clerk SignIn component:
    - Import SignIn from @clerk/nextjs
    - Wrap in centered div with min-h-screen for full-page display
    - Configure appearance with shadcn/ui-compatible styling:
      - rootBox: w-full max-w-md
      - card: bg-background border shadow-sm
    - Set forceRedirectUrl and fallbackRedirectUrl to /dashboard
    - Use dark theme to match existing layout
  </action>
  <verify>File created at src/app/sign-in/[[...sign-in]]/page.tsx, contains SignIn component with appearance config</verify>
  <done>User can navigate to /sign-in and see branded sign-in form with email/password and OAuth options</done>
</task>

<task type="auto">
  <name>Task 2: Create custom sign-up page</name>
  <files>src/app/sign-up/[[...sign-up]]/page.tsx</files>
  <action>
    Create directory structure src/app/sign-up/[[...sign-up]]/
    Create page.tsx with Clerk SignUp component:
    - Import SignUp from @clerk/nextjs
    - Mirror sign-in page styling for consistency
    - Configure appearance with same styling as sign-in:
      - rootBox: w-full max-w-md
      - card: bg-background border shadow-sm
    - Set forceRedirectUrl and fallbackRedirectUrl to /dashboard
    - Use dark theme matching sign-in
  </action>
  <verify>File created at src/app/sign-up/[[...sign-up]]/page.tsx, contains SignUp component with appearance config</verify>
  <done>User can navigate to /sign-up and see branded registration form with email/password and OAuth options</done>
</task>

<task type="auto">
  <name>Task 3: Create custom forgot-password page</name>
  <files>src/app/forgot-password/page.tsx</files>
  <action>
    Create directory src/app/forgot-password/
    Create page.tsx with custom password reset flow:
    - Add 'use client' directive at top
    - Import useState, useSignIn from @clerk/nextjs, useRouter from next/navigation
    - Create three-step state: 'request' | 'reset' | 'complete'
    - Step 1 (request): Form with email input, calls signIn.create with reset_password_email_code strategy
    - Step 2 (reset): Form with code input + new password, calls signIn.attemptFirstFactor
    - Step 3 (complete): Success message with link to sign-in
    - Style with Tailwind CSS matching shadcn/ui theme
    - Handle loading and error states
  </action>
  <verify>File created at src/app/forgot-password/page.tsx, contains three-step password reset flow</verify>
  <done>User can request password reset via email and complete reset with verification code</done>
</task>

<task type="auto">
  <name>Task 4: Create user button component</name>
  <files>src/components/auth/user-button.tsx</files>
  <action>
    Create directory src/components/auth/
    Create user-button.tsx:
    - Add 'use client' directive
    - Import SignedIn, SignedOut, SignInButton, UserButton from @clerk/nextjs
    - Render SignedOut: SignInButton with modal mode, styled as button with primary classes
    - Render SignedIn: UserButton with afterSignOutUrl="/"
    - Style UserButton avatar: h-9 w-9 for consistent sizing
    - Export as named export AuthButton
  </action>
  <verify>File created at src/components/auth/user-button.tsx, contains SignedIn/SignedOut conditional rendering</verify>
  <done>Header shows Sign In button when signed out, User avatar when signed in</done>
</task>

<task type="auto">
  <name>Task 5: Update layout with UserButton in header</name>
  <files>src/app/layout.tsx</files>
  <action>
    Update src/app/layout.tsx:
    - Import AuthButton from @/components/auth/user-button
    - Add header inside body with flex justify-end p-4 gap-4
    - Place AuthButton in header
    - Wrap children in main tag for semantic HTML
    - Keep existing ClerkProvider and ThemeProvider wrapping
  </action>
  <verify>layout.tsx updated, AuthButton component imported and rendered in header</verify>
  <done>Auth button visible in header on all pages, shows correct state based on auth</done>
</task>

<task type="auto">
  <name>Task 6: Configure Clerk environment variables</name>
  <files>.env.local</files>
  <action>
    Check if .env.local exists, create if not
    Add Clerk environment variables:
    - NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in
    - NEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up
    - NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL=/dashboard
    - NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL=/dashboard
    - NEXT_PUBLIC_CLERK_AFTER_SIGN_OUT_URL=/
    - CLERK_SIGN_IN_FALLBACK_REDIRECT_URL=/dashboard
    - CLERK_SIGN_UP_FALLBACK_REDIRECT_URL=/dashboard
    Note: Do NOT add actual keys - user must provide CLERK_SECRET_KEY and NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY
  </action>
  <verify>.env.local contains Clerk redirect URL configuration</verify>
  <done>Clerk auth flow redirects to custom pages instead of Clerk Account Portal</done>
</task>

</tasks>

<verification>
1. Navigate to /sign-in - should show custom Clerk sign-in with styled card
2. Navigate to /sign-up - should show custom Clerk sign-up with styled card
3. Navigate to /forgot-password - should show password reset flow
4. Check header - should show Sign In button when signed out
5. Environment variables configured for proper redirects
</verification>

<success_criteria>

- AUTH-01: User can sign up with email and password (via /sign-up page)
- AUTH-02: User can sign in with email and password (via /sign-in page)
- AUTH-05: Session persists (handled automatically by Clerk)
- AUTH-06: User can sign out (UserButton provides sign out)
- AUTH-07: User can reset password via email (via /forgot-password)
  </success_criteria>

<output>
After completion, create `.planning/phases/02-authentication/02-01-SUMMARY.md`
</output>
