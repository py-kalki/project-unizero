---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified: []
autonomous: true
user_setup:
  - service: clerk
    why: "Authentication provider"
    env_vars:
      - name: NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY
        source: "Clerk Dashboard -> API Keys"
      - name: CLERK_SECRET_KEY
        source: "Clerk Dashboard -> API Keys"
    dashboard_config:
      - task: "Create application in Clerk"
        location: "Clerk Dashboard -> Applications"
      - task: "Configure OAuth (optional for Google/GitHub)"
        location: "Clerk Dashboard -> OAuth Providers"
  - service: postgresql
    why: "Local development database"
    env_vars:
      - name: DATABASE_URL
        source: "Local PostgreSQL connection string (postgresql://user:pass@localhost:5432/dbname)"

must_haves:
  truths:
    - "Prisma can connect to PostgreSQL database"
    - "User table exists in database with proper schema"
    - "Clerk authentication protects routes"
    - "Dark/light mode toggle works"
    - "shadcn/ui components render correctly"
    - "ESLint + Prettier + Husky workflow functions"
  artifacts:
    - path: "prisma/schema.prisma"
      provides: "Database schema with User model"
      contains: "model User"
    - path: "src/lib/db.ts"
      provides: "Prisma client singleton"
      contains: "PrismaClient"
    - path: "middleware.ts"
      provides: "Clerk route protection"
      contains: "clerkMiddleware"
    - path: "src/components/theme-provider.tsx"
      provides: "Dark/light mode provider"
    - path: "src/components/ui/button.tsx"
      provides: "shadcn button component"
    - path: ".env.example"
      provides: "Environment variable template"
      contains: "DATABASE_URL"
    - path: ".husky/pre-commit"
      provides: "Husky pre-commit hook"
      contains: "lint-staged"
---

<objective>
Complete infrastructure setup: Prisma with PostgreSQL, Clerk authentication, shadcn/ui components, and development workflow tools.

Purpose: Finalize the foundational infrastructure enabling all future features to be built on a solid base.
Output: Fully configured development environment with database, auth, UI components, and dev tools
</objective>

<execution_context>
@C:/Users/ASUS/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/ASUS/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Setup Prisma with PostgreSQL and User model</name>
  <files>prisma/schema.prisma, src/lib/db.ts, .env, .env.example</files>
  <action>
    Install Prisma and initialize with PostgreSQL:

    ```bash
    npm install prisma --save-dev
    npx prisma init --datasource-provider postgresql
    ```

    Update prisma/schema.prisma to add the User model (per locked decisions - incremental build with Users table only):

    ```prisma
    generator client {
      provider = "prisma-client-js"
    }

    datasource db {
      provider = "postgresql"
      url      = env("DATABASE_URL")
    }

    model User {
      id        String   @id @default(cuid())
      email     String   @unique
      name      String?
      createdAt DateTime @default(now())
      updatedAt DateTime @updatedAt

      @@index([email])
    }
    ```

    Create src/lib/db.ts with Prisma singleton pattern (per research - prevents connection exhaustion):

    ```typescript
    import { PrismaClient } from '@prisma/client'

    const globalForPrisma = globalThis as unknown as {
      prisma: PrismaClient | undefined
    }

    export const prisma = globalForPrisma.prisma ?? new PrismaClient()

    if (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma
    ```

    Create .env file with DATABASE_URL (local PostgreSQL per locked decisions) and create .env.example template.
  </action>
  <verify>
    Run `npx prisma db push` to sync schema to database. Verify:
    1. Database connection successful
    2. User table created
    3. Prisma client generates without errors: `npx prisma generate`
  </verify>
  <done>
    Prisma configured with:
    - PostgreSQL datasource provider
    - User model with id, email, name, createdAt, updatedAt
    - Prisma client singleton in src/lib/db.ts
    - DATABASE_URL in .env and .env.example
    - Schema synced to database
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure Clerk authentication with App Router</name>
  <files>middleware.ts, src/app/layout.tsx, .env, .env.local</files>
  <action>
    Install Clerk SDK:

    ```bash
    npm install @clerk/nextjs
    ```

    Create middleware.ts at project root (per research - use clerkMiddleware, NOT deprecated authMiddleware):

    ```typescript
    import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'

    const isProtectedRoute = createRouteMatcher([
      '/dashboard(.*)',
      '/settings(.*)'
    ])

    export default clerkMiddleware((auth, req) => {
      if (isProtectedRoute(req)) auth().protect()
    })

    export const config = {
      matcher: [
        '/((?!.*\\..*|_next).*)',
        '/',
        '/(api|trpc)(.*)'
      ]
    }
    ```

    Update src/app/layout.tsx to include ClerkProvider (per research patterns):

    ```typescript
    import { ClerkProvider } from '@clerk/nextjs'
    import { dark } from '@clerk/themes'
    import './globals.css'

    export default function RootLayout({ children }: { children: React.ReactNode }) {
      return (
        <ClerkProvider
          appearance={{
            baseTheme: dark
          }}
        >
          <html lang="en" suppressHydrationWarning>
            <body>{children}</body>
          </html>
        </ClerkProvider>
      )
    }
    ```

    Add Clerk environment variables to .env and .env.example (NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY, CLERK_SECRET_KEY, and Clerk redirect URLs).
  </action>
  <verify>
    1. Add NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY and CLERK_SECRET_KEY to .env
    2. Run `npm run dev`
    3. Visit localhost:3000 - should show Clerk SignIn component (unauthenticated)
    4. The middleware should not block the home page but will protect /dashboard if visited
  </verify>
  <done>
    Clerk authentication configured with:
    - clerkMiddleware() in middleware.ts (not deprecated authMiddleware)
    - ClerkProvider in root layout
    - Protected routes pattern (/dashboard, /settings)
    - Environment variables configured
  </done>
</task>

<task type="auto">
  <name>Task 3: Setup shadcn/ui with dark/light mode</name>
  <files>src/components/theme-provider.tsx, src/components/ui/button.tsx, src/components/ui/input.tsx, src/components/ui/card.tsx, src/components/ui/table.tsx, components.json, src/app/globals.css</files>
  <action>
    Install shadcn/ui and required dependencies:

    ```bash
    npm install next-themes clsx tailwind-merge
    npx shadcn-ui@latest init
    ```

    When prompted, use these settings:
    - Style: Default
    - Base Color: Slate
    - CSS variables: Yes
    - Custom prefix: No
    - tailwind.config.js: tailwind.config.ts
    - CSS variables: src/app/globals.css

    Create ThemeProvider component (src/components/theme-provider.tsx):

    ```typescript
    "use client"

    import * as React from "react"
    import { ThemeProvider as NextThemesProvider } from "next-themes"
    import { type ThemeProviderProps } from "next-themes/dist/types"

    export function ThemeProvider({ children, ...props }: ThemeProviderProps) {
      return <NextThemesProvider {...props}>{children}</NextThemesProvider>
    }
    ```

    Update src/app/layout.tsx to wrap children with ThemeProvider:

    ```typescript
    import { ThemeProvider } from '@/components/theme-provider'

    // Inside ClerkProvider > html > body:
    <ThemeProvider
      attribute="class"
      defaultTheme="system"
      enableSystem
      disableTransitionOnChange
    >
      {children}
    </ThemeProvider>
    ```

    Install essential shadcn components (per locked decisions - Button, Input, Card, Table first):

    ```bash
    npx shadcn-ui@latest add button input card table
    ```
  </action>
  <verify>
    1. Run `npm run dev`
    2. Check localhost:3000 - shadcn/ui components should render with proper styling
    3. Verify dark mode works: check that dark: CSS variables are applied when system is in dark mode
    4. Check that ThemeProvider is wrapping the app in layout source
  </done>
  <done>
    shadcn/ui configured with:
    - ThemeProvider for dark/light mode (system preference detection)
    - Button, Input, Card, Table components installed
    - CSS variables in globals.css
    - next-themes for theme switching
    - clsx + tailwind-merge for class combining
  </done>
</task>

<task type="auto">
  <name>Task 4: Configure development workflow (ESLint, Prettier, Husky)</name>
  <files>.eslintrc.json, prettier.config.js, .prettierrc, .husky/pre-commit, package.json</files>
  <action>
    Install development tools:

    ```bash
    npm install --save-dev prettier husky lint-staged eslint-config-prettier
    ```

    Create prettier.config.js:

    ```javascript
    /** @type {import('prettier').Config} */
    const config = {
      trailingComma: 'es5',
      tabWidth: 2,
      semi: true,
      singleQuote: true,
    }

    module.exports = config
    ```

    Create .prettierrc (alternative):

    ```json
    {
      "semi": true,
      "singleQuote": true,
      "tabWidth": 2,
      "trailingComma": "es5"
    }
    ```

    Update package.json to add lint-staged config:

    ```json
    {
      "lint-staged": {
        "*.{ts,tsx}": ["eslint --fix", "prettier --write"],
        "*.{json,css,md}": ["prettier --write"]
      }
    }
    ```

    Initialize Husky and create pre-commit hook:

    ```bash
    npx husky init
    echo "npx lint-staged" > .husky/pre-commit
    ```

    Update the created .husky/pre-commit to use npm/npx properly on Windows.
  </action>
  <verify>
    1. Create a test TypeScript file with formatting issues
    2. Run `npx lint-staged` or stage and commit - should auto-fix and format
    3. Check that ESLint runs and Prettier formats the code
    4. Verify Husky hook exists at .husky/pre-commit
  </verify>
  <done>
    Development workflow configured with:
    - ESLint for code linting
    - Prettier for code formatting
    - Husky pre-commit hooks
    - lint-staged for staged file processing
    - Automatic fix on commit
  </done>
</task>

</tasks>

<verification>
1. Database: `npx prisma db push` succeeds, `npx prisma generate` succeeds
2. Auth: Clerk sign-in renders on localhost:3000
3. UI: shadcn components render with proper styling, dark mode toggle works
4. Dev tools: Pre-commit hook runs lint-staged, formatting works
5. All environment variables in .env.example template
</verification>

<success_criteria>
- [ ] Prisma connected to PostgreSQL with User model
- [ ] Clerk authentication integrated with App Router
- [ ] shadcn/ui components (Button, Input, Card, Table) installed
- [ ] Dark/light mode working via ThemeProvider
- [ ] ESLint + Prettier + Husky workflow functional
- [ ] .env.example created with all required variables
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
